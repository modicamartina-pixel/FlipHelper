<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FlipHelper — Annunci & Prezzo</title>
  <meta name="theme-color" content="#0ea5e9" />
  <link rel="manifest" href="./manifest.webmanifest">
  <style>
    :root{
      --bg:#0b1220;
      --panel:#0e1729;
      --muted:#91a3b0;
      --text:#e6eef6;
      --brand:#22c55e;
      --brand-2:#0ea5e9;
      --radius:16px;
      --shadow:0 10px 30px rgba(0,0,0,.35);
      --input:#0b1424;
      --border:rgba(255,255,255,.08);
    }
    @media (prefers-color-scheme:light){
      :root{
        --bg:#f5f7fb; --panel:#ffffff; --text:#0b1220; --muted:#5c6b76;
        --input:#f3f6fb; --border:rgba(0,0,0,.08);
      }
    }
    [data-theme="light"]{
      --bg:#f5f7fb; --panel:#ffffff; --text:#0b1220; --muted:#5c6b76;
      --input:#f3f6fb; --border:rgba(0,0,0,.08);
    }
    [data-theme="dark"]{
      --bg:#0b1220; --panel:#0e1729; --text:#e6eef6; --muted:#91a3b0;
      --input:#0b1424; --border:rgba(255,255,255,.08);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Ubuntu,Arial,sans-serif;
      background:
        radial-gradient(1200px 600px at 100% -20%, color-mix(in oklab, var(--brand-2) 18%, transparent), transparent 60%),
        radial-gradient(1000px 600px at -20% 120%, color-mix(in oklab, var(--brand) 12%, transparent), transparent 60%),
        var(--bg);
      color:var(--text);
      line-height:1.35;
    }
    .wrap{max-width:940px;margin-inline:auto;padding:24px clamp(16px,3vw,28px) 64px}
    header{display:flex; gap:14px; align-items:center; margin-bottom:18px; justify-content:space-between}
    .brand{display:flex; gap:12px; align-items:center}
    .logo{
      width:44px;height:44px;display:grid;place-items:center;
      border-radius:12px;
      background:linear-gradient(135deg,var(--brand-2),#38bdf8);
      box-shadow:var(--shadow);font-weight:800;color:#031320
    }
    h1{font-size:clamp(22px,4.6vw,34px); margin:0}
    .sub{color:var(--muted); font-size:.95rem}

    .theme-btn{
      appearance:none;border:1px solid var(--border);background:var(--panel);
      color:var(--text);border-radius:12px;padding:10px 12px;cursor:pointer
    }

    .grid{display:grid; gap:14px; grid-template-columns:1fr}
    @media (min-width:880px){ .grid{grid-template-columns:1.2fr .9fr} }

    .card{
      background:linear-gradient(180deg,rgba(255,255,255,.03),transparent 40%), var(--panel);
      border:1px solid var(--border);
      border-radius:var(--radius);
      box-shadow:var(--shadow); padding:18px;
    }
    .card h2{margin:4px 0 14px; font-size:1.1rem}
    label{display:block; font-size:.9rem; color:var(--muted); margin:10px 0 6px}
    input, select, textarea{
      width:100%; background:var(--input); color:var(--text);
      border:1px solid var(--border); border-radius:12px; padding:12px 14px;
      outline:none; transition:.18s border, .18s box-shadow;
    }
    input:focus, select:focus, textarea:focus{
      border-color:#38bdf8; box-shadow:0 0 0 4px rgba(14,165,233,.18);
    }
    textarea{min-height:110px; resize:vertical}
    .row{display:grid; gap:10px; grid-template-columns:1fr}
    @media (min-width:560px){ .row{ grid-template-columns:1fr 1fr } }

    .btns{display:flex; flex-wrap:wrap; gap:10px; margin-top:12px}
    button{
      appearance:none; border:0; cursor:pointer;
      padding:12px 16px; border-radius:12px; font-weight:700;
      transition:transform .05s ease, filter .15s ease;
    }
    .primary{background:linear-gradient(135deg,var(--brand),#16a34a); color:#06280f}
    .ghost{background:var(--input); color:var(--text); border:1px solid var(--border)}
    .light{background:linear-gradient(135deg,var(--brand-2),#38bdf8); color:#031320}
    button:active{transform:translateY(1px)}
    .muted{color:var(--muted); font-size:.9rem}

    .out{display:grid; gap:10px}
    .pill{
      display:flex; align-items:center; justify-content:space-between;
      background:var(--input); border:1px solid var(--border);
      padding:12px 14px; border-radius:12px;
    }
    .price{ font-size:clamp(22px,5.6vw,32px); font-weight:900; letter-spacing:.3px}
    .copy{ padding:8px 12px; border-radius:10px; border:1px solid var(--border); background:var(--panel); color:var(--text)}
    .footer{margin-top:24px; color:var(--muted); font-size:.85rem; text-align:center}
    .tag{display:inline-flex; gap:6px; align-items:center; font-size:.8rem; background:var(--input); border:1px solid var(--border); padding:6px 10px; border-radius:999px}
  </style>
</head>
<body>
  <div class="wrap" id="appRoot">
    <header>
      <div class="brand">
        <div class="logo">FH</div>
        <div>
          <h1>FlipHelper</h1>
          <div class="sub">Crea l’annuncio perfetto e calcola il prezzo in 1 minuto.</div>
        </div>
      </div>
      <button class="theme-btn" id="toggleTheme">Tema: auto</button>
    </header>

    <div class="grid">
      <!-- Form -->
      <section class="card">
        <h2>Dettagli articolo</h2>

        <label for="titolo">Titolo</label>
        <input id="titolo" placeholder="Es. Sneakers Nike Air Max 37 EU"/>

        <div class="row">
          <div>
            <label for="categoria">Categoria</label>
            <select id="categoria">
              <option>Abbigliamento</option>
              <option>Scarpe</option>
              <option>Accessori</option>
              <option>Elettronica</option>
              <option>Casa</option>
              <option>Altro</option>
            </select>
          </div>
          <div>
            <label for="condizione">Condizione</label>
            <select id="condizione">
              <option>Ottimo</option>
              <option>Buono</option>
              <option>Discreto</option>
              <option>Nuovo con etichette</option>
              <option>Nuovo senza etichette</option>
            </select>
          </div>
        </div>

        <div class="row">
          <div>
            <label for="costo">Costo acquisto (€)</label>
            <input id="costo" type="number" min="0" step="0.01" value="0" />
          </div>
          <div>
            <label for="spese">Spese (lavaggio, riparazioni, ecc.) (€)</label>
            <input id="spese" type="number" min="0" step="0.01" value="0" />
          </div>
        </div>

        <div class="row">
          <div>
            <label for="margine">Margine desiderato (%)</label>
            <input id="margine" type="number" min="0" max="300" step="1" value="30" />
          </div>
          <div>
            <label for="fee">Commissione marketplace (%)</label>
            <input id="fee" type="number" min="0" max="50" step="0.1" value="0" />
          </div>
        </div>

        <label for="descr">Descrizione</label>
        <textarea id="descr" placeholder="Taglia, misure, difetti, materiali, vestibilità..."></textarea>

        <div class="btns">
          <button class="primary" id="calcola">Calcola prezzo</button>
          <button class="light" id="genera">Genera annuncio</button>
          <button class="ghost" id="reset">Pulisci</button>
        </div>

        <p class="muted" style="margin-top:10px">
          Se il marketplace trattiene una percentuale, imposta <b>commissione</b>.  
          Su Vinted/Wallapop spesso le fee le paga l’acquirente → puoi lasciare 0%.
        </p>
      </section>

      <!-- Risultati -->
      <section class="card">
        <h2>Risultati</h2>

        <div class="out">
          <div class="pill">
            <div>
              <div class="muted">Prezzo suggerito</div>
              <div class="price" id="prezzoOut">—</div>
            </div>
            <button class="copy" data-copy="#prezzoOut">Copia</button>
          </div>

          <div>
            <div class="muted" style="margin-bottom:6px">Annuncio (titolo + descrizione)</div>
            <textarea id="annuncioOut" readonly></textarea>
            <div class="btns" style="margin-top:8px">
              <button class="ghost" id="copyTitolo">Copia solo titolo</button>
              <button class="ghost" id="copyDescr">Copia solo descrizione</button>
              <button class="ghost" id="copyAnnuncio">Copia tutto</button>
              <button class="ghost" id="shareAnnuncio">Condividi…</button>
            </div>
          </div>

          <div class="muted">
            <span class="tag" id="recap">Costi totali €0 — Margine 0%</span>
          </div>
        </div>
      </section>
    </div>

    <p class="footer">© FlipHelper — versione leggera per GitHub Pages. In seguito possiamo aggiungere icone/PWA, immagini e salvataggi cloud.</p>
  </div>

  <script>
    // ------- THEME TOGGLE (auto / light / dark)
    const root = document.documentElement;
    const themeBtn = document.getElementById('toggleTheme');
    function applyTheme(mode){ // 'auto' | 'light' | 'dark'
      root.removeAttribute('data-theme');
      if (mode === 'light') root.setAttribute('data-theme','light');
      if (mode === 'dark') root.setAttribute('data-theme','dark');
      localStorage.setItem('fh_theme', mode);
      themeBtn.textContent = `Tema: ${mode}`;
    }
    themeBtn.addEventListener('click', ()=>{
      const cur = localStorage.getItem('fh_theme') || 'auto';
      applyTheme(cur === 'auto' ? 'light' : cur === 'light' ? 'dark' : 'auto');
    });
    applyTheme(localStorage.getItem('fh_theme') || 'auto');

    // ------- Utility
    const $ = s => document.querySelector(s);
    const val = id => (document.getElementById(id).value || '').trim();
    const money = n => isNaN(n) ? '—' : new Intl.NumberFormat('it-IT',{style:'currency',currency:'EUR'}).format(n);

    // ------- Calcolo prezzo
    function calcolaPrezzo(){
      const costo = parseFloat(val('costo')) || 0;
      const spese = parseFloat(val('spese')) || 0;
      const marginPct = parseFloat(val('margine')) || 0;
      const feePct = parseFloat(val('fee')) || 0;

      const costoTot = costo + spese;
      let prezzo = costoTot * (1 + marginPct/100);
      if (feePct > 0) prezzo *= (1 + feePct/100);

      prezzo = Math.max(prezzo, 1);
      const pretty = Math.round(prezzo) - 0.01;

      $('#prezzoOut').textContent = money(pretty);
      $('#recap').textContent = `Costi totali ${money(costoTot)} — Margine ${marginPct}%`;
      return pretty;
    }

    // ------- Annuncio
    function generaAnnuncio(){
      const titolo = val('titolo') || 'Articolo';
      const categoria = val('categoria');
      const condizione = val('condizione');
      const descr = val('descr');
      const prezzo = calcolaPrezzo();

      const testoTitolo = `${titolo}`;
      const testoDescr = `Categoria: ${categoria}\nCondizione: ${condizione}.\n${descr}\n\nPrezzo: ${money(prezzo)}.\nDisponibile per spedizione o ritiro.`;
      $('#annuncioOut').value = `${testoTitolo}\n\n${testoDescr}`;
      salvaDraft();
      return {titolo:testoTitolo, descr: testoDescr};
    }

    // ------- Copia & Condividi
    function copiaSelettore(sel){
      const el = $(sel);
      const text = el?.innerText || el?.value || '';
      if (!text) return;
      navigator.clipboard.writeText(text).then(()=> toast('Copiato!'));
    }
    function copiaTesto(text){
      navigator.clipboard.writeText(text).then(()=> toast('Copiato!'));
    }
    function toast(msg){
      const t = document.createElement('div');
      t.textContent = msg;
      t.style.cssText = "position:fixed;left:50%;bottom:30px;transform:translateX(-50%);background:#111827;color:#e6eef6;padding:10px 14px;border:1px solid rgba(255,255,255,.14);border-radius:10px;box-shadow:0 8px 20px rgba(0,0,0,.35);z-index:9999";
      document.body.appendChild(t);
      setTimeout(()=>{ t.remove() },1200);
    }

    // ------- Local Storage (bozza)
    const fields = ['titolo','categoria','condizione','costo','spese','margine','fee','descr'];
    function salvaDraft(){
      const data = {};
      fields.forEach(id => data[id] = val(id));
      localStorage.setItem('fh_draft', JSON.stringify(data));
    }
    function caricaDraft(){
      const raw = localStorage.getItem('fh_draft');
      if(!raw) return;
      try{
        const data = JSON.parse(raw);
        fields.forEach(id => {
          if(data[id] !== undefined) document.getElementById(id).value = data[id];
        });
      }catch(e){}
    }

    // ------- Eventi
    $('#calcola').addEventListener('click', calcolaPrezzo);
    $('#genera').addEventListener('click', ()=>{
      const x = generaAnnuncio();
      lastPieces = x; // per i bottoni di copia singola
    });
    $('#reset').addEventListener('click', ()=>{
      fields.forEach(id => document.getElementById(id).value = id==='margine' ? 30 : (id==='fee'?0:''));
      $('#annuncioOut').value = '';
      $('#prezzoOut').textContent = '—';
      $('#recap').textContent = 'Costi totali €0 — Margine 0%';
      localStorage.removeItem('fh_draft');
      lastPieces = {titolo:'', descr:''};
    });
    document.querySelector('[data-copy="#prezzoOut"]').addEventListener('click', ()=> copiaSelettore('#prezzoOut'));
    $('#copyAnnuncio').addEventListener('click', ()=> copiaSelettore('#annuncioOut'));

    let lastPieces = {titolo:'', descr:''};
    $('#copyTitolo').addEventListener('click', ()=>{
      if(!lastPieces.titolo) lastPieces = generaAnnuncio();
      copiaTesto(lastPieces.titolo);
    });
    $('#copyDescr').addEventListener('click', ()=>{
      if(!lastPieces.descr) lastPieces = generaAnnuncio();
      copiaTesto(lastPieces.descr);
    });
    $('#shareAnnuncio').addEventListener('click', ()=>{
      const text = ($('#annuncioOut').value || '').trim() || (generaAnnuncio(), $('#annuncioOut').value);
      if (navigator.share) navigator.share({text}).catch(()=>{});
      else copiaTesto(text);
    });

    // autosave
    document.querySelectorAll('input,select,textarea').forEach(i=> i.addEventListener('input', salvaDraft));
    caricaDraft();
    calcolaPrezzo();
  </script>
  <script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('./sw.js');
    });
  }
  </script>
</body>
</html>
