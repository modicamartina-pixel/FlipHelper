<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FlipHelper – Annunci & Prezzo</title>

  <!-- PWA -->
  <link rel="manifest" href="./manifest.webmanifest" />
  <meta name="theme-color" content="#0f172a" />

  <!-- Font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg1:#0ea5ea;  /* azzurro */
      --bg2:#7c3aed;  /* viola   */
      --ink:#e2e8f0;  /* testo chiaro */
      --muted:#94a3b8;
      --glass: rgba(255,255,255,.07);
      --stroke: rgba(255,255,255,.14);
      --accent:#22c55e;  /* verde pulsanti */
      --accent-2:#f59e0b; /* arancio pill */
    }

    *{ box-sizing: border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      color:var(--ink);
      background: radial-gradient(1300px 900px at 10% 10%, rgba(255,255,255,.12), transparent 60%),
                  radial-gradient(1200px 700px at 90% 20%, rgba(255,255,255,.10), transparent 60%),
                  linear-gradient(135deg, var(--bg1), var(--bg2));
      background-size: 200% 200%;
      animation: moveBg 18s ease-in-out infinite alternate;
    }
    @keyframes moveBg{
      from{ background-position: 0% 0%, 100% 0%, 0% 0%; }
      to{   background-position: 100% 100%, 0% 100%, 100% 100%; }
    }

    .wrap{
      max-width: 1100px;
      margin: 40px auto;
      padding: 0 16px;
    }

    .hero{
      display:flex; align-items:center; gap:16px;
      margin-bottom: 14px;
    }
    .logo{
      width:48px; height:48px; border-radius:12px;
      background: linear-gradient(135deg, rgba(255,255,255,.25), rgba(255,255,255,.05));
      box-shadow: inset 0 0 0 1px var(--stroke), 0 8px 30px rgba(0,0,0,.25);
      display:grid; place-items:center; font-weight:800; letter-spacing:.5px;
    }
    h1{ margin:0; font-size: clamp(26px, 3.4vw, 40px); }
    .sub{ color:var(--muted); margin-top:4px; }

    .chips{ display:flex; gap:8px; flex-wrap:wrap; margin-top:10px; }
    .chip{
      font-size:13px; padding:6px 10px; border-radius:999px;
      background:rgba(0,0,0,.22); border:1px solid var(--stroke);
    }
    .chip--accent{ background: rgba(34,197,94,.18); border-color: rgba(34,197,94,.4); }

    .grid{
      display:grid; gap:18px; margin-top:22px;
      grid-template-columns: 1fr;
    }
    @media (min-width: 900px){
      .grid{ grid-template-columns: 1.1fr .9fr; }
    }

    .card{
      background: var(--glass);
      border: 1px solid var(--stroke);
      border-radius: 18px;
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      padding: 18px;
    }
    .card h2{ margin:4px 0 14px; font-size: clamp(18px, 2.2vw, 22px); }

    label{
      display:block; margin:14px 0 8px; font-weight:600; font-size:14px;
    }
    input[type="text"], input[type="number"], select, textarea{
      width:100%;
      background: rgba(255,255,255,.05);
      border:1px solid var(--stroke);
      color:var(--ink);
      border-radius: 12px;
      padding: 12px 13px;
      outline:none;
      transition: .2s border-color, .2s background;
    }
    textarea{ min-height:110px; resize: vertical; }
    input:focus, select:focus, textarea:focus{
      border-color: rgba(255,255,255,.45);
      background: rgba(255,255,255,.09);
    }
    .row{ display:grid; gap:12px; grid-template-columns: 1fr; }
    @media (min-width: 640px){ .row{ grid-template-columns: 1fr 1fr; } }

    .btns{ display:flex; gap:10px; flex-wrap:wrap; margin-top:14px; }
    .btn{
      border:0; padding:12px 16px; border-radius:12px; font-weight:700;
      cursor:pointer; transition:.2s transform,.2s filter; will-change: transform;
    }
    .btn:hover{ transform: translateY(-1px); filter: brightness(1.05); }
    .btn:active{ transform: translateY(0); }
    .btn--accent{ background: var(--accent); color:#06210f; }
    .btn--ghost{ background: transparent; color: var(--ink); border:1px solid var(--stroke); }

    .result{
      background: rgba(0,0,0,.18);
      border: 1px dashed var(--stroke);
      border-radius: 14px;
      padding: 12px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
      word-break: break-word;
      cursor: pointer;
      user-select: none;
    }
    .result:active{ transform: scale(.995); }

    .price{
      font-size: clamp(26px, 4vw, 34px);
      font-weight: 800;
      margin: 8px 0 2px;
    }
    .muted{ color:var(--muted); font-size: 13px; }

    footer{
      text-align:center; color:var(--muted); margin:26px 0 10px; font-size:13px;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="hero">
      <div class="logo">FH</div>
      <div>
        <h1>FlipHelper</h1>
        <div class="sub">Crea annunci velocemente e ottieni un <b>prezzo suggerito</b> per Vinted / Wallapop.</div>
        <div class="chips">
          <div class="chip chip--accent">Senza login</div>
          <div class="chip">Mobile-friendly</div>
          <div class="chip">Copia con un tocco</div>
        </div>
      </div>
    </div>

    <div class="grid">
      <!-- FORM -->
      <section class="card">
        <h2>Dati articolo</h2>

        <label for="title">Titolo</label>
        <input id="title" type="text" placeholder="Es. Sneakers Nike Air Max 90" />

        <div class="row">
          <div>
            <label for="category">Categoria</label>
            <select id="category">
              <option>Abbigliamento</option>
              <option>Scarpe</option>
              <option>Borse</option>
              <option>Accessori</option>
              <option>Elettronica</option>
              <option>Casa &amp; Living</option>
              <option>Libri / Media</option>
              <option>Altro</option>
            </select>
          </div>
          <div>
            <label for="condition">Condizione</label>
            <select id="condition">
              <option>Ottimo</option>
              <option>Buono</option>
              <option>Discreto</option>
              <option>Nuovo con etichette</option>
            </select>
          </div>
        </div>

        <div class="row">
          <div>
            <label for="margin">Margine desiderato (%)</label>
            <input id="margin" type="number" value="30" min="0" step="1" />
          </div>
          <div>
            <label for="cost">Costo acquisto (€)</label>
            <input id="cost" type="number" value="0" min="0" step="0.01" />
          </div>
        </div>

        <div class="row">
          <div>
            <label for="fees">Spese (lavaggio, riparazioni, ecc.) (€)</label>
            <input id="fees" type="number" value="0" min="0" step="0.01" />
          </div>
          <div>
            <label for="ship">Spedizione (facoltativa) (€)</label>
            <input id="ship" type="number" value="0" min="0" step="0.01" />
          </div>
        </div>

        <label for="desc">Descrizione</label>
        <textarea id="desc" placeholder="Taglia, misura, difetti, materiali, vestibilità…"></textarea>

        <div class="btns">
          <button class="btn btn--accent" id="btnPrice">Calcola prezzo</button>
          <button class="btn btn--ghost" id="btnAd">Genera annuncio</button>
        </div>
      </section>

      <!-- RISULTATI -->
      <section class="card">
        <h2>Risultato</h2>

        <div>
          <div class="muted">Prezzo suggerito</div>
          <div class="price" id="priceOut">—</div>
          <div class="muted" id="priceNote"></div>
        </div>

        <div style="margin-top:18px;">
          <div class="muted" style="margin-bottom:8px;">Annuncio (tocca per copiare)</div>
          <div class="result" id="adOut">—</div>
        </div>
      </section>
    </div>

    <footer>Tip: tocca i riquadri per copiare il testo negli appunti.</footer>
  </div>

  <script>
    // --- UTIL
    const € = (n) => new Intl.NumberFormat('it-IT', {style:'currency', currency:'EUR'}).format(n);

    const el = (id) => document.getElementById(id);
    const title = el('title');
    const category = el('category');
    const condition = el('condition');
    const margin = el('margin');
    const cost = el('cost');
    const fees = el('fees');
    const ship = el('ship');
    const desc = el('desc');

    const priceOut = el('priceOut');
    const priceNote = el('priceNote');
    const adOut = el('adOut');

    // Piccola funzione per stimare tasse/piattaforma (molto semplificato)
    function platformFee(subtotal){
      // simuliamo 10% + 0,35 €
      return subtotal * 0.10 + 0.35;
    }

    function calcPrice(){
      const c = parseFloat(cost.value || 0);
      const f = parseFloat(fees.value || 0);
      const s = parseFloat(ship.value || 0);
      const m = Math.max(0, parseFloat(margin.value || 0)) / 100;

      // costo totale prima del margine
      const base = c + f + s;

      // target “utile desiderato”
      const desiredProfit = base * m;

      // prezzo lordo prima delle fee piattaforma
      const gross = base + desiredProfit;

      // fee piattaforma (semplificate)
      const pf = platformFee(gross);

      // prezzo finale arrotondato a .90
      let final = gross + pf;
      final = Math.max(final, 0);
      final = Math.round(final) - 0.10;   // 19.90, 24.90 ecc.
      if (final < 1) final = Math.round(gross + pf); // fallback

      priceOut.textContent = €(final);
      priceNote.textContent = `Base ${€(base)} + margine ~${Math.round(m*100)}% + fee piattaforma ≈ ${€(pf)}.`;
      return final;
    }

    function makeAd(){
      const t = title.value?.trim() || 'Articolo';
      const cat = category.value;
      const cond = condition.value;
      const d = desc.value?.trim() || 'Info in descrizione.';

      const price = calcPrice();

      const bullets = [
        `Categoria: ${cat}`,
        `Condizione: ${cond}`,
        `Spese incluse: ${€(parseFloat(fees.value||0))}`,
        (ship.value && parseFloat(ship.value)>0) ? `Spedizione stimata: ${€(parseFloat(ship.value))}` : null
      ].filter(Boolean);

      const txt =
`${t} – ${cond}
${d}

${bullets.map(b=>`• ${b}`).join('\n')}
Prezzo suggerito: ${€(price)}

#fliphelper #secondamano #${cat.toLowerCase().replace(/[^a-zàèéìòù0-9]+/gi,'')}`;
      adOut.textContent = txt;
      return txt;
    }

    // Eventi
    document.getElementById('btnPrice').addEventListener('click', calcPrice);
    document.getElementById('btnAd').addEventListener('click', makeAd);

    // copia con un tocco
    adOut.addEventListener('click', async () => {
      const text = adOut.textContent.trim();
      if (!text || text === '—') return;
      try{
        await navigator.clipboard.writeText(text);
        adOut.style.borderColor = 'rgba(34,197,94,.7)';
        setTimeout(()=> adOut.style.borderColor = 'var(--stroke)', 650);
      }catch{}
    });

    // calcolo iniziale
    calcPrice();

    // PWA: registra service worker se presente
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js').catch(()=>{});
      });
    }
  </script>
</body>
</html>
